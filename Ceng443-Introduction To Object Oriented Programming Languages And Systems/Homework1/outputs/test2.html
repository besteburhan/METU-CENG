<html><head><title>test2</title></head><body><p>Atomics:</p><math><mrow><mn>42</mn></mrow></math><math><mrow><mi>x</mi></mrow></math><math><mrow><msub><mi>V</mi><mn>0</mn></msub></mrow></math><p>Ops with atomic operands:</p><math><mrow><mo>(</mo><mrow><mi>x</mi></mrow><mo>+</mo><mrow><mi>y</mi></mrow><mo>)</mo></mrow></math><math><mrow><mfrac><mrow><mi>x</mi></mrow><mrow><mi>y</mi></mrow></mfrac></mrow></math><math><mrow><mo>(</mo><mrow><mi>x</mi></mrow><mo>&times;</mo><mrow><mi>y</mi></mrow><mo>)</mo></mrow></math><math><mrow><mo>(</mo><mrow><mi>x</mi></mrow><mo>&vdash;</mo><mrow><mi>y</mi></mrow><mo>)</mo></mrow></math><p>A big expression composed of small ones</p><p>small1</p><math><mrow><mfrac><mrow><mo>(</mo><mrow><mi>x</mi></mrow><mo>+</mo><mrow><mn>3</mn></mrow><mo>)</mo></mrow><mrow><msub><mi>V</mi><mn>1</mn></msub></mrow></mfrac></mrow></math><p>small2</p><math><mrow><mfrac><mrow><mo>(</mo><mrow><msub><mi>V</mi><mn>1</mn></msub></mrow><mo>&times;</mo><mrow><mi>x</mi></mrow><mo>)</mo></mrow><mrow><mfrac><mrow><msub><mi>V</mi><mn>1</mn></msub></mrow><mrow><mn>3</mn></mrow></mfrac></mrow></mfrac></mrow></math><p>big</p><math><mrow><mo>(</mo><mrow><mfrac><mrow><mfrac><mrow><mo>(</mo><mrow><mi>x</mi></mrow><mo>+</mo><mrow><mn>3</mn></mrow><mo>)</mo></mrow><mrow><msub><mi>V</mi><mn>1</mn></msub></mrow></mfrac></mrow><mrow><msub><mi>V</mi><mn>1</mn></msub></mrow></mfrac></mrow><mo>&times;</mo><mrow><mo>(</mo><mrow><mfrac><mrow><mo>(</mo><mrow><msub><mi>V</mi><mn>1</mn></msub></mrow><mo>&times;</mo><mrow><mi>x</mi></mrow><mo>)</mo></mrow><mrow><mfrac><mrow><msub><mi>V</mi><mn>1</mn></msub></mrow><mrow><mn>3</mn></mrow></mfrac></mrow></mfrac></mrow><mo>+</mo><mrow><mi>x</mi></mrow><mo>)</mo></mrow><mo>)</mo></mrow></math><p>9 Atomics</p><p>testexp, testexp2, testexp3</p><math><mrow><mfrac><mrow><mo>(</mo><mrow><mi>x</mi></mrow><mo>+</mo><mrow><mn>3</mn></mrow><mo>)</mo></mrow><mrow><mn>3</mn></mrow></mfrac></mrow></math><math><mrow><mfrac><mrow><mo>(</mo><mrow><mi>x</mi></mrow><mo>+</mo><mrow><mn>3</mn></mrow><mo>)</mo></mrow><mrow><mn>3</mn></mrow></mfrac></mrow></math><math><mrow><mfrac><mrow><mo>(</mo><mrow><mi>x</mi></mrow><mo>+</mo><mrow><mn>3</mn></mrow><mo>)</mo></mrow><mrow><mn>2</mn></mrow></mfrac></mrow></math><p>testvar before being matched</p><p><math><mrow><msub><mi>V</mi><mn>2</mn></msub></mrow></math></p><p>The match should be true with testexp since it is the first match: true</p><p>Now the situation is</p><p><math><mrow><msub><mi>V</mi><mn>2</mn></msub><mo>[</mo><mrow><mfrac><mrow><mo>(</mo><mrow><mi>x</mi></mrow><mo>+</mo><mrow><mn>3</mn></mrow><mo>)</mo></mrow><mrow><mn>3</mn></mrow></mfrac></mrow><mo>]</mo></mrow></math></p><p>The match should be true with textexp2 since it is the same thing: true</p><p>Now the situation is</p><p><math><mrow><msub><mi>V</mi><mn>2</mn></msub><mo>[</mo><mrow><mfrac><mrow><mo>(</mo><mrow><mi>x</mi></mrow><mo>+</mo><mrow><mn>3</mn></mrow><mo>)</mo></mrow><mrow><mn>3</mn></mrow></mfrac></mrow><mo>]</mo></mrow></math></p><p>The match should be false with textexp3: false</p><p>Now the situation is</p><p><math><mrow><msub><mi>V</mi><mn>2</mn></msub><mo>[</mo><mrow><mfrac><mrow><mo>(</mo><mrow><mi>x</mi></mrow><mo>+</mo><mrow><mn>3</mn></mrow><mo>)</mo></mrow><mrow><mn>3</mn></mrow></mfrac></mrow><mo>]</mo></mrow></math></p><p>Try burying testvar into some big expression with other vars and then call ClearVarsVisitor to see the effects. Before</p><p><math><mrow><mfrac><mrow><mn>1</mn></mrow><mrow><mfrac><mrow><msub><mi>V</mi><mn>5</mn></msub><mo>[</mo><mrow><mn>5</mn></mrow><mo>]</mo></mrow><mrow><mfrac><mrow><mn>3</mn></mrow><mrow><mo>(</mo><mrow><msub><mi>V</mi><mn>6</mn></msub><mo>[</mo><mrow><mi>z</mi></mrow><mo>]</mo></mrow><mo>+</mo><mrow><msub><mi>V</mi><mn>2</mn></msub><mo>[</mo><mrow><mfrac><mrow><mo>(</mo><mrow><mi>x</mi></mrow><mo>+</mo><mrow><mn>3</mn></mrow><mo>)</mo></mrow><mrow><mn>3</mn></mrow></mfrac></mrow><mo>]</mo></mrow><mo>)</mo></mrow></mfrac></mrow></mfrac></mrow></mfrac></mrow></math></p><p>after </p><p><math><mrow><mfrac><mrow><mn>1</mn></mrow><mrow><mfrac><mrow><msub><mi>V</mi><mn>5</mn></msub></mrow><mrow><mfrac><mrow><mn>3</mn></mrow><mrow><mo>(</mo><mrow><msub><mi>V</mi><mn>6</mn></msub></mrow><mo>+</mo><mrow><msub><mi>V</mi><mn>2</mn></msub></mrow><mo>)</mo></mrow></mfrac></mrow></mfrac></mrow></mfrac></mrow></math></p><p>Some sample expressions for X + X -| 2X</p><p>matches1</p><math><mrow><mo>(</mo><mrow><mfrac><mrow><mn>1</mn></mrow><mrow><mn>0</mn></mrow></mfrac></mrow><mo>+</mo><mrow><mfrac><mrow><mn>1</mn></mrow><mrow><mn>0</mn></mrow></mfrac></mrow><mo>)</mo></mrow></math><p>matches2</p><math><mrow><mo>(</mo><mrow><mi>x</mi></mrow><mo>+</mo><mrow><mi>x</mi></mrow><mo>)</mo></mrow></math><p>doesntmatch</p><math><mrow><mo>(</mo><mrow><mi>x</mi></mrow><mo>+</mo><mrow><mfrac><mrow><mn>1</mn></mrow><mrow><mn>0</mn></mrow></mfrac></mrow><mo>)</mo></mrow></math><p>rule, newly created</p><p><math><mrow><mo>(</mo><mrow><mo>(</mo><mrow><msub><mi>V</mi><mn>8</mn></msub></mrow><mo>+</mo><mrow><msub><mi>V</mi><mn>8</mn></msub></mrow><mo>)</mo></mrow><mo>&vdash;</mo><mrow><mo>(</mo><mrow><mn>2</mn></mrow><mo>&times;</mo><mrow><msub><mi>V</mi><mn>8</mn></msub></mrow><mo>)</mo></mrow><mo>)</mo></mrow></math></p><p>Try applying it to matches1, the rule is cleared, if it 'doesn't match', it should stay clear</p><p><math><mrow><mo>(</mo><mrow><mo>(</mo><mrow><msub><mi>V</mi><mn>8</mn></msub><mo>[</mo><mrow><mfrac><mrow><mn>1</mn></mrow><mrow><mn>0</mn></mrow></mfrac></mrow><mo>]</mo></mrow><mo>+</mo><mrow><msub><mi>V</mi><mn>8</mn></msub><mo>[</mo><mrow><mfrac><mrow><mn>1</mn></mrow><mrow><mn>0</mn></mrow></mfrac></mrow><mo>]</mo></mrow><mo>)</mo></mrow><mo>&vdash;</mo><mrow><mo>(</mo><mrow><mn>2</mn></mrow><mo>&times;</mo><mrow><msub><mi>V</mi><mn>8</mn></msub><mo>[</mo><mrow><mfrac><mrow><mn>1</mn></mrow><mrow><mn>0</mn></mrow></mfrac></mrow><mo>]</mo></mrow><mo>)</mo></mrow><mo>)</mo></mrow></math></p><p>Try applying it to matches2, the rule is cleared, if it 'doesn't match', it should stay clear</p><p><math><mrow><mo>(</mo><mrow><mo>(</mo><mrow><msub><mi>V</mi><mn>8</mn></msub><mo>[</mo><mrow><mi>x</mi></mrow><mo>]</mo></mrow><mo>+</mo><mrow><msub><mi>V</mi><mn>8</mn></msub><mo>[</mo><mrow><mi>x</mi></mrow><mo>]</mo></mrow><mo>)</mo></mrow><mo>&vdash;</mo><mrow><mo>(</mo><mrow><mn>2</mn></mrow><mo>&times;</mo><mrow><msub><mi>V</mi><mn>8</mn></msub><mo>[</mo><mrow><mi>x</mi></mrow><mo>]</mo></mrow><mo>)</mo></mrow><mo>)</mo></mrow></math></p><p>Try applying it to doesntmatch, the rule is cleared, if it 'doesn't match', it should stay clear</p><p><math><mrow><mo>(</mo><mrow><mo>(</mo><mrow><msub><mi>V</mi><mn>8</mn></msub></mrow><mo>+</mo><mrow><msub><mi>V</mi><mn>8</mn></msub></mrow><mo>)</mo></mrow><mo>&vdash;</mo><mrow><mo>(</mo><mrow><mn>2</mn></mrow><mo>&times;</mo><mrow><msub><mi>V</mi><mn>8</mn></msub></mrow><mo>)</mo></mrow><mo>)</mo></mrow></math></p></body></html>
